<div class="justifs-page">
  <app-header [title]="'Justificatifs'">
    <a appBtn variant="primary" routerLink="/justificatifs/upload">Uploader</a>
  </app-header>

  <app-card>
    <app-card-header>
      <h2>Filtres</h2>
    </app-card-header>
    <app-card-body>
      <div class="filters">
        <div class="filter-group">
          <label>Catégorie</label>
          <select class="form-control" [(ngModel)]="selectedCategory" (ngModelChange)="onCategoryChange()">
            <option [ngValue]="undefined">Toutes</option>
            <option *ngFor="let c of categories" [ngValue]="c">{{ c }}</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Recherche</label>
          <input type="text" class="form-control" [(ngModel)]="search" (ngModelChange)="onSearchChange()" placeholder="Rechercher..." />
        </div>
      </div>
    </app-card-body>
  </app-card>

  <app-loader *ngIf="loading"></app-loader>

  <app-card *ngIf="!loading">
    <app-card-header>
      <h2>Liste</h2>
    </app-card-header>
    <app-card-body>
      <div class="list-card">
        <div class="list-header">
          <span>Fichier</span>
          <span>Mission</span>
          <span>Catégorie</span>
          <span>Montant</span>
          <span>Statut</span>
          <span>Date</span>
          <span></span>
        </div>

        <div class="list-item" *ngFor="let it of filteredItems">
          <div class="col file">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            {{ it.filename || it.name || '-' }}
          </div>
          <div class="col">{{ it.mission?.title || '-' }}</div>
          <div class="col">{{ it.category || '-' }}</div>
          <div class="col">{{ it.amount | number:'1.2-2' }} CFA</div>
          <div class="col"><app-badge [variant]="getStatusVariant(it.status)">{{ getStatusLabel(it.status) }}</app-badge></div>
          <div class="col">{{ it.createdAt | date:'dd/MM/yyyy' }}</div>
          <div class="col actions">
            <button appBtn variant="outline" (click)="viewDetails(it.id)">Voir</button>
            <button appBtn variant="danger" (click)="openDelete(it.id)">Supprimer</button>
          </div>
        </div>

        <div class="empty-state" *ngIf="!hasItems">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
          </svg>
          <p>Aucun justificatif</p>
        </div>
      </div>

      <div class="totals" *ngIf="hasItems">
        <div><strong>Total:</strong> {{ totals.overall | number:'1.2-2' }} CFA</div>
        <div class="by-cat">
          <span *ngFor="let c of categories">{{ c }}: {{ totals.byCategory[c] | number:'1.2-2' }} CFA</span>
        </div>
      </div>
    </app-card-body>
  </app-card>

  <app-confirmation-dialog
    *ngIf="showDelete"
    title="Supprimer le justificatif"
    message="Confirmer la suppression ?"
    confirmText="Supprimer"
    cancelText="Annuler"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()">
  </app-confirmation-dialog>
 
</div>
